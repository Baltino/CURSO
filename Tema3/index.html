<!--
To change this template, choose Tools | Templates
and open the template in the editor.
-->
<!DOCTYPE html>
<html>
    <head>
        <title>Patrones</title>
        <meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
       <meta name="viewport" content="width=device-width, initial-scale=1"> 
	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.1.0-rc.1/jquery.mobile-1.1.0-rc.1.min.css" />
	<script src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
	<script src="http://code.jquery.com/mobile/1.1.0-rc.1/jquery.mobile-1.1.0-rc.1.min.js"></script>
	
        
    </head>
    <body>
       <!-- Start of first page -->
	<div data-role="page" id="inicial">

		<div data-role="header" data-id="menu" >
			<h1>Dia 2</h1>
			
		</div><!-- /header -->

		<div data-role="content">	
                    <h1>Patrones</h1>
                    <p> Hola que tal </p>
			
		</div><!-- /content -->

	</div><!-- /page -->
    </body>
    <script type="text/javascript">
           
        //Observer/subscriber of play/stop events   
        function MovieObserver(){
            
            this.listenPlays = function(){
                $('#inicial').on('playEvent',function(e,movie){
                    console.log('Playing ' +movie.getTitle()+'...');
                });
            }
            this.listenStops = function(){
                $('#inicial').on('StopEvent',function(e,movie){
                    console.log('Stopped ' +movie.getTitle()+'.');
                });
            }
        }
        /*
      //Movie Class Standard
       function Movie(id, title, rating){
            
            // Private vars
            
            var movie_id = id;
            var movie_title = title;
            var movie_rating = rating;

      
            //Privileged methods
            
            this.getId = function(){
                return movie_id;
            }
            this.getTitle = function(){
                return movie_title;
            }
            this.getRating = function(){
                return movie_rating;
            }

            this.setId = function(id){
                movie_id = id;
            }
            this.setTitle = function(title){
                movie_title = title 
            }
            this.setRating = function(rating){
                movie_rating = rating;
            }

            this.play = function(){
                $('#inicial').trigger('playEvent',this);
                console.log('PlayEvent triggered.');
            }
            this.stop = function(){
                $('#inicial').trigger('StopEvent',this);
                console.log('StopEvent triggered');
            }
        }
        */
        
        
        
        //Movie class with Module pattern improved
        function Movie(){
            
            // Private vars
            var movie_id;
            var movie_title;
            var movie_rating;
            var movie_cast;
          
            Movie.prototype.getId = function(){
                return this.movie_id;
            }
            Movie.prototype.getTitle = function(){
                return this.movie_title;
            }
            Movie.prototype.getRating = function(){
                return this.movie_rating;
            }

            Movie.prototype.setId = function(id){
                this.movie_id = id;
            }
            Movie.prototype.setTitle = function(title){
                this.movie_title = title 
            }
            Movie.prototype.setRating = function(rating){
                this.movie_rating = rating;
            }
            
            //punto 14 adding
            Movie.prototype.setCast = function(cast){
                this.movie_cast = cast;
            }
            
            //me pareció mejor tener un arreglo de Objetos Actor antes que los strings
            //con el nombre, como muestra el ejemplo. No es tan acotado.            
            Movie.prototype.getCast = function(){
                var toR = [];
                for(var i=0,len=this.movie_cast.length; i<len; i++){
                    toR[i] = this.movie_cast[i].getName();
                }
                return toR;
            }

            //current movie object is passed
            Movie.prototype.play = function(){
                $('#inicial').trigger('playEvent',this);
                console.log('PlayEvent triggered.');
            }
            //current movie object is passed
            Movie.prototype.stop = function(){
                $('#inicial').trigger('StopEvent',this);
                console.log('StopEvent triggered');
            }
       
        };
        
        //singleton. unique object instance
        var MovieDownloader = (function(){
            var instanciated;
            
            function init(){
                return{
                    download: function(movie){
                        console.log('Downloading '+movie.getTitle());
                    }
                };
            }
            return {
                getInstance: function(){
                    if(!instanciated){
                        instanciated = init();
                    }
                    return instanciated;
                }
            }
        })();
        
        // Social Mixin to add anywhere
        var SocialMixin = function(){};
        SocialMixin.prototype = {
            share: function(friendName){
                console.log('Sharing '+this.getTitle() +' with '+ friendName);
            },
            like: function(){
                console.log('like ++');
            }
        };
        
   


// Augment existing 'class' with a method from another
function augment( receivingClass, givingClass ) {
  // only provide certain methods
  if ( arguments[2] ) {
    for (var i=2, len=arguments.length; i<len; i++) {
      receivingClass.prototype[arguments[i]] = givingClass.prototype[arguments[i]];
    }
  }
  // provide all methods
  else {
    for ( var methodName in givingClass.prototype ) {
      /* check to make sure the receiving class doesn't 
         have a method of the same name as the one currently 
         being processed */
      if ( !receivingClass.prototype[methodName] ) {
        receivingClass.prototype[methodName] = givingClass.prototype[methodName];
      }
    }
  }
}

        augment(Movie,SocialMixin,'like','share');
        
        
        //Movie extension
        function DownloadableMovie(){
            
            for ( var methodName in Movie.prototype ) {
                
                DownloadableMovie.prototype[methodName] = Movie.prototype[methodName];
            }
            DownloadableMovie.prototype.download = function(){
                //download;
               MovieDownloader.getInstance().download(this);
               
               
            }              
            
        };
     
       
        //class Actor
        function Actor(){
            var name;
            var biography;
            
            Actor.prototype.getName = function(){
                return this.name;
            }
            Actor.prototype.setName = function(n){
                this.name = n;
            }
            Actor.prototype.getBiography = function(){
                return this.biography;
            }
            
            Actor.prototype.setBiography = function(bio){
                this.biography = bio;
            }
        };
        
        var nueveReinas = new Movie();
        
        var darin = new Actor();
        darin.setName('Ricardo Darin');
        darin.setBiography('Excellent argentinian actor');
        var cage = new Actor();
        cage.setName('Nicholas Cage');
        cage.setBiography('Very bad actor');
        var pauls = new Actor();
        pauls.setName('Gaston Pauls');
        pauls.setBiography('Acting since he was a little boy');
        
        nueveReinas.setCast([darin,pauls]);
      
    </script>
</html>
